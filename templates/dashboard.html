{% extends "bootstrap/base.html" %}
{% block title %} Dashboard {% endblock %}
{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
    body, html {
        height: 100%;
        margin: 0;
    }
    .video-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
    }
    .bg-custom {
        background-color: #003366; 
    }
    .navbar-dark .navbar-nav .nav-link {
        color: white;
    }
    .navbar-dark .navbar-brand {
        color: white;
    }
    .navbar-dark .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cpath stroke='rgba(255, 255, 255, 1)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
    }
    .form-container {
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        margin-top: 60px;
        margin-bottom: 100px;
        overflow: hidden;
    }
    .form-title {
        margin-bottom: 30px;
        font-weight: bold;
        color: #003366;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-control {
        border-radius: 10px;
    }
    .btn-primary {
        background-color: #003366;
        border: none;
        border-radius: 10px;
        transition: background-color 0.3s ease;
    }
    .btn-primary:hover {
        background-color: #00509e;
    }
    #result {
        margin-top: 20px;
        padding: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .prediction-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }
  
  .prediction-table th, .prediction-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
  }
  
  .prediction-table th {
      background-color: #003366;
      color: white;
      font-weight: bold;
  }
  
  .prediction-table td {
      background-color: #f9f9f9;
  }
  
  .prediction-table ul {
      list-style-type: none;
      padding: 0;
  }
  
  .prediction-table ul li {
      padding: 5px 0;
      font-size: 16px;
  }
  
  #resetButton {
      margin-top: 20px;
      background-color: #003366;
      border: none;
      border-radius: 10px;
      transition: background-color 0.3s ease;
  }
  
  #resetButton:hover {
      background-color: #00509e;
  }
  
</style>

{% endblock %}
{% block content %}
<body>
  <video autoplay muted loop class="video-bg">
    <source src="../static/vid.mp4" type="video/mp4">
  </video>

<nav class="navbar navbar-expand-lg navbar-dark bg-custom fixed-top shadow-lg">
  <div class="container-fluid">

    <a class="navbar-brand fs-3" href="/">Admission Recommendation</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 fs-3 ">
        <li class="nav-item">
          <a class="nav-link " href="#">Dashboard</a>
        </li>

        <li class="nav-item ms-5">
          <a class="nav-link" href="{{ url_for('logout') }}">Log Out</a>
        </li>
      </ul>

    </div>
  </div>
</nav>

<div class="container d-flex justify-content-center">
  <div class="form-container">
    <h1 class="text-center form-title fs-1 fw-bold">Welcome To</h1>
    <h1 class="text-center form-title fs-1 fw-bold">Admission Recommendation System</h1>
    <p class="text-center fs-4 mb-5" id="result">Fill the to predict your result</p>
    <div id="main-div">
      <form id="prediction-form">
        {{ form.hidden_tag() }}
        <div class="row">
          <div class="form-group col-md-6 fs-4">
            {{ form.admission_marks.label(class="form-label") }} 
            {{ form.admission_marks(class="form-control") }}
          </div>
          <div class="form-group col-md-6 fs-4">
            {{ form.minimum_entry_mark.label(class="form-label") }} 
            {{ form.minimum_entry_mark(class="form-control") }}
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-6 fs-4">
            {{ form.fees_structure.label(class="form-label") }} 
            {{ form.fees_structure(class="form-control") }}
          </div>
          <div class="form-group col-md-6 fs-4">
            <label for="degree" class="form-label">Select Intermediate Subjects</label>
            <select class="form-select" id="degree" name="degree" aria-label="Select Degree">
                <option selected value="" >Select your major</option>
                <option value="pre_medical">Pre Medical</option>
                <option value="ics">ICS</option>
                <option value="fa">FA</option>
                <option value="pre_eng">Pre Engineering</option>
                <option value="icom">I-Com</option>
            </select>
           
          </div>
          <div class="form-group col-12 fs-4">
            <label for="departments_offered" class="form-label rounded-pill h-5">Your Interest</label>
            <select id="departments_offered" name="departments_offered" class="form-select">
                <option value="" selected>Select an interest</option>
                {% if departments %}
                    {% for department in departments %}
                        <option value="{{ department }}">{{ department }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        
        </div>
        <button type="button" class="btn btn-primary w-100 mt-3 py-3 fs-4" onclick="submitForm()">Predict</button>
      </form>
    </div>
    
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script>
$(document).ready(function() {
  $('#departments_offered').select2();
});

function submitForm() {
  if (!validateForm()) {
    return;
  }
  
  const form = document.getElementById('prediction-form');
  const formData = new FormData(form);
  console.log(formData);
  const data = {
    'Admission marks': formData.get('admission_marks'),
    'minimum entry mark': formData.get('minimum_entry_mark'),
    'fees structure': formData.get('fees_structure'),
    'Departments_Offered': formData.get('departments_offered')
  };
  fetch('/predict', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(result => {
    if (result.error) {
      document.getElementById('result').innerHTML = `<p class="text-danger">Error: ${result.error}</p>`;
    } else {
      // Hide the form
      document.getElementById('main-div').style.display = 'none';
      
      // Create a dynamic table to show predicted results
      const resultTable = `
        <table class="prediction-table">
          <thead>
            <tr>
              <th>University</th>
              <th>Department</th>
              <th>Careers</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
               <ul>
                  ${result.university.map(uni => `<li>${uni}</li>`).join('')}
                </ul>
              
              <td>${result.Department}</td>
              <td>
                <ul>
                  ${result.careers.map(career => `<li>${career}</li>`).join('')}
                </ul>
              </td>
            </tr>
          </tbody>
        </table>
        <button id="resetButton" class="btn btn-primary w-100 mt-3 py-3 fs-4" onclick="location.reload()">Predict Again</button>
      `;

      // Append the table to #result div
      document.getElementById('result').innerHTML = resultTable;
    }
  })
  .catch(error => {
    document.getElementById('result').innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
  });

  function validateForm() {
    document.getElementById('result').innerHTML = ``;
    const admissionMarks = parseFloat(document.getElementById('admission_marks').value);
    const minimumEntryMarks = parseFloat(document.getElementById('minimum_entry_mark').value);
    const uni_fees_structure = parseFloat(document.getElementById('fees_structure').value);
    const departmentName = document.getElementById('departments_offered').value;
    const prevDegree = document.getElementById('degree').value;
   
    let errorMessages = [];
    
    if (departmentName === '') {
      errorMessages.push('Please Select your Interest');
      
    }
    if (prevDegree==='') {
      errorMessages.push('Please Select your Previous Digree');
      
    }
  
    // Validate admission_marks between 400 and 1100
    if (isNaN(admissionMarks) || admissionMarks < 40 || admissionMarks > 100) {
      errorMessages.push('HSSC Marks percentage must be between 40 and 100.');
    }
  
    // Validate minimum_entry_mark between 400 and 1100
    if (isNaN(minimumEntryMarks) || minimumEntryMarks < 40 || minimumEntryMarks > 100) {
      errorMessages.push('SSC Marks percentage be between 40 and 100.');
    }
  
    // Validate minimum_entry_mark between 400 and 1100
    if (isNaN(uni_fees_structure) || uni_fees_structure < 25000 || uni_fees_structure > 280000) {
      errorMessages.push('Affortable fee must be between 24500 and 278950');
    }
  
    if (errorMessages.length > 0) {
      document.getElementById('result').innerHTML = `<p class="text-danger">${errorMessages.join('<br>')}</p>`;
      return false; // Prevent form submission
    }

  
    return true; // Allow form submission
  }
}

</script>
{% endblock %}
